{% extends "base.html" %}
{% block content %}
  <h1>用户管理（管理员）</h1>

  <div class="card">
    <h2>部门</h2>
    <form method="post" action="/admin/teams" class="rowform">
      <input name="name" placeholder="新增部门名称" required />
      <button class="btn primary" type="submit">新增部门</button>
    </form>
    <div class="hint">提示：部门用于部门视图筛选与人员归属。</div>
  </div>

  <div class="card">
    <h2>新增用户</h2>
    <form method="post" action="/admin/users" class="grid">
      <label>用户名</label>
      <input name="username" required />
      <label>姓名</label>
      <input name="name" required />
      <label>部门</label>
      <select name="team_id">
        <option value="">-</option>
        {% for t in teams %}
          <option value="{{ t.id }}">{{ t.name }}</option>
        {% endfor %}
      </select>
      <label>角色</label>
      <select name="role">
        <option value="user">用户</option>
        <option value="admin">管理员</option>
      </select>
      <label>初始密码</label>
      <input name="password" type="password" required />
      <div></div>
      <button class="btn primary" type="submit">创建</button>
    </form>
  </div>

  <div class="card">
    <h2>用户列表</h2>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>用户名</th>
          <th>姓名</th>
          <th>部门</th>
          <th>角色</th>
          <th>创建时间</th>
          <th>更新</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
          <tr>
            <td>{{ u.id }}</td>
            <td>{{ u.username }}</td>
            <td>{{ u.name }}</td>
            <td>{{ u.team.name if u.team else "" }}</td>
            <td>{{ u.role }}</td>
            <td>{{ u.created_at.strftime("%Y-%m-%d %H:%M") if u.created_at else "" }}</td>
            <td class="actions-col">
              <form method="post" action="/admin/users/{{ u.id }}/update" class="rowform">
                <input name="name" value="{{ u.name }}" />
                <select name="team_id">
                  <option value="">-</option>
                  {% for t in teams %}
                    <option value="{{ t.id }}" {% if u.team_id == t.id %}selected{% endif %}>{{ t.name }}</option>
                  {% endfor %}
                </select>
                <select name="role">
                  <option value="user" {% if u.role == "user" %}selected{% endif %}>用户</option>
                  <option value="admin" {% if u.role == "admin" %}selected{% endif %}>管理员</option>
                </select>
                <input name="new_password" type="password" placeholder="重置密码(可空)" />
                <button class="btn small primary" type="submit">保存</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
